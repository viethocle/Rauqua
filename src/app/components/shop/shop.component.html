<div id="main-product" class="col-md-12">
  <button class="create-order btn btn-primary" (click)="openModalAddShop()">
    Tạo mới cửa hàng
  </button>

  <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" id="dynamic-table_wrapper" class="table table-striped table-bordered
  table-hover dataTable no-footer"
    cellspacing="0" width="100%">
    <thead>
      <tr>
        <th>ID</th>
        <th>Tên Shop</th>
        <th>Ảnh đại diện</th>
        <th>Địa chỉ</th>
        <th>Chủ cửa hàng</th>
        <th>Số điện thoại</th>
        <th class="sorting_disabled">Hoạt động</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let shop of shops">
        <td>{{ shop.id }}</td>
        <td>{{ shop.name }}</td>
        <td> <img src="{{ shop.image }}" alt=""  height="60"> </td>
        <td>{{ shop.address }}</td>
        <td>{{ shop.provider.username }}</td>
        <td>{{ shop.phone }}</td>
        <td class="center">
          <button class="btn btn-xs btn-info" tooltip="{{ 'Sửa'}}" (click)="openModalEditShop(shop)">
            <i class="ace-icon fa fa-pencil bigger-120"></i>
          </button>
          <button class="btn btn-xs btn-danger" tooltip="{{ 'Xóa' }}" (click)="deleteShop(shop.id)">
            <i class="ace-icon fa fa-trash-o bigger-120"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<bs-modal #modalCreate cssClass="modal-lg">
  <bs-modal-header [showDismiss]="true">
    <h4 class="modal-title">Tạo mới cửa hàng</h4>
  </bs-modal-header>

  <bs-modal-body>
    <app-input-field [attribute]="'Tên cửa hàng'" [control]="form.get('name')">
    </app-input-field>
    <app-error-label [control]="form"></app-error-label>

    <h4>Nhà cung cấp:</h4>
    <div class="input-group">
      <input type="search" class="form-control" [(ngModel)]="termCustomer" (input)="onChangeTermCustomer()" (keyup.enter)="chooseCustomer()"
        (keyup.escape)="escapeSearch($event)" (keydown.arrowup)="shiftFocusUp($event)" (keydown.arrowdown)="shiftFocusDown($event)">
      <span class="input-group-addon">
        <i class="ace-icon fa fa-search"></i>
      </span>
    </div>

    <div class="results">
      <perfect-scrollbar class="scroller">
        <div [ngClass]="{'box-container' : termCustomer != ''}">
          <ng-container *ngFor="let customer of provider|mySearch:termCustomer; let rowIDx = index">
            <ng-container *ngIf="termCustomer != ''">
              <button type="button" class="list-group-item list-customers" [attr.data-rowIndex]="rowIDx" [attr.data-idCustomer]="customer.id"
                #listCustomers (click)="selectCustomer(customer)">
                <strong>{{ customer.username }}</strong> - {{ customer.phone }}</button>
            </ng-container>
          </ng-container>
        </div>
      </perfect-scrollbar>

      <div [hidden]="!(provider?.length === 0 && termCustomer != '')">
        Không có kết quả
      </div>
    </div>

    <!-- show customer selected -->
    <div *ngIf="customerSelected && termCustomer == ''" [@flyInOut]="'in'">
      <div class="widget-box widget-color-green2">
        <div class="widget-header">
          <h5 class="widget-title bigger lighter">
            <i class="ace-icon fa fa-users"></i> Nhà cung cấp:
          </h5>
          <i class="ace-icon fa fa-times close-btn pointer" tooltip="Đóng" (click)="customerSelected=null"></i>
        </div>
        <div class="widget-body">
          <div class="widget-main">
            <dl class="dl-horizontal">
              <dt>Tên nhà cung cấp</dt>
              <dd>{{customerSelected?.username}}</dd>

              <dt>Số điện thoại</dt>
              <dd>{{customerSelected?.phone}}</dd>

              <dt>Email</dt>
              <dd>{{customerSelected?.email}}</dd>

              <dt>Địa chỉ</dt>
              <dd>{{customerSelected?.address}}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <app-input-field [attribute]="'Địa chỉ'" [control]="form.get('address')">
    </app-input-field>
    <app-error-label [control]="form"></app-error-label>

    <app-input-field [attribute]="'Số điện thoại'" [control]="form.get('phone')">
    </app-input-field>
    <app-error-label [control]="form"></app-error-label>

    <h3>File upload</h3>
    <input style="display: none" type="file" (change)="onFileSelected($event)" #fileInput>
    <button (click)="fileInput.click()">Pick File</button>
    <img [src]="url" height="50"> <br />

  </bs-modal-body>

  <bs-modal-footer>
    <button type="button" class="btn btn-default" data-dismiss="modal" (click)="modalCreate.dismiss()">
      {{ "Hủy bỏ" }}
    </button>
    <button type="button" class="btn btn-primary" (click)="createShop()">
      {{ "Tạo Mới" }}
    </button>
  </bs-modal-footer>
</bs-modal>


<bs-modal #modalEdit cssClass="modal-lg">
  <bs-modal-header [showDismiss]="true">
    <h4 class="modal-title">Chỉnh sửa cửa hàng</h4>
  </bs-modal-header>

  <bs-modal-body>
    <app-input-field [attribute]="'Tên cửa hàng'" [control]="form.get('name')">
    </app-input-field>
    <app-error-label [control]="form"></app-error-label>

    <h4>Nhà cung cấp:</h4>
    <div class="input-group">
      <input type="search" class="form-control" [(ngModel)]="termCustomer" (input)="onChangeTermCustomer()" (keyup.enter)="chooseCustomer()"
        (keyup.escape)="escapeSearch($event)" (keydown.arrowup)="shiftFocusUp($event)" (keydown.arrowdown)="shiftFocusDown($event)">
      <span class="input-group-addon">
        <i class="ace-icon fa fa-search"></i>
      </span>
    </div>

    <div class="results">
      <perfect-scrollbar class="scroller">
        <div [ngClass]="{'box-container' : termCustomer != ''}">
          <ng-container *ngFor="let customer of provider|mySearch:termCustomer; let rowIDx = index">
            <ng-container *ngIf="termCustomer != ''">
              <button type="button" class="list-group-item list-customers" [attr.data-rowIndex]="rowIDx" [attr.data-idCustomer]="customer.id"
                #listCustomers (click)="selectCustomer(customer)">
                <strong>{{ customer.username }}</strong> - {{ customer.phone }}</button>
            </ng-container>
          </ng-container>
        </div>
      </perfect-scrollbar>

      <div [hidden]="!(provider?.length === 0 && termCustomer != '')">
        Không có kết quả
      </div>
    </div>

    <!-- show customer selected -->
    <div *ngIf="customerSelected && termCustomer == ''" [@flyInOut]="'in'">
      <div class="widget-box widget-color-green2">
        <div class="widget-header">
          <h5 class="widget-title bigger lighter">
            <i class="ace-icon fa fa-users"></i> Nhà cung cấp:
          </h5>
          <i class="ace-icon fa fa-times close-btn pointer" tooltip="Đóng" (click)="customerSelected=null"></i>
        </div>
        <div class="widget-body">
          <div class="widget-main">
            <dl class="dl-horizontal">
              <dt>Tên nhà cung cấp</dt>
              <dd>{{customerSelected?.username}}</dd>

              <dt>Số điện thoại</dt>
              <dd>{{customerSelected?.phone}}</dd>

              <dt>Email</dt>
              <dd>{{customerSelected?.email}}</dd>

              <dt>Địa chỉ</dt>
              <dd>{{customerSelected?.address}}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <app-input-field [attribute]="'Địa chỉ'" [control]="form.get('address')">
    </app-input-field>
    <app-error-label [control]="form"></app-error-label>

    <app-input-field [attribute]="'Số điện thoại'" [control]="form.get('phone')">
    </app-input-field>
    <app-error-label [control]="form"></app-error-label>

    <h3>File upload</h3>
    <input style="display: none" type="file" (change)="onFileSelected($event)" #fileInput>
    <button (click)="fileInput.click()">Pick File</button>
    <img [src]="url" height="50"> <br />

  </bs-modal-body>

  <bs-modal-footer>
    <button type="button" class="btn btn-default" data-dismiss="modal" (click)="closeModalEditShop()">
      Hủy bỏ
    </button>
    <button type="button" class="btn btn-primary" (click)="editShop()">
      Chỉnh sửa
    </button>
  </bs-modal-footer>
</bs-modal>